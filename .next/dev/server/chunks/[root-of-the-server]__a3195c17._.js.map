{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/haseeb/Projects/dashboard/src/lib/auth-server.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { parse, serialize } from \"cookie\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"nexus-dashboard-secret-key-change-in-prod\";\nconst COOKIE_NAME = \"nexus_token\";\n\n// â”€â”€â”€ In-memory user store (replace with DB in production) â”€â”€â”€\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  passwordHash: string;\n  role: \"admin\" | \"analyst\" | \"viewer\";\n  createdAt: string;\n}\n\nconst users: User[] = [];\n\n// Seed default admin\n(async () => {\n  const hash = await bcrypt.hash(\"admin123\", 10);\n  users.push({\n    id: \"1\",\n    email: \"admin@nexus.io\",\n    name: \"Alex Morgan\",\n    passwordHash: hash,\n    role: \"admin\",\n    createdAt: new Date().toISOString(),\n  });\n})();\n\n// â”€â”€â”€ User CRUD â”€â”€â”€\nexport function findByEmail(email: string): User | undefined {\n  return users.find((u) => u.email.toLowerCase() === email.toLowerCase());\n}\n\nexport async function createUser(email: string, name: string, password: string): Promise<User> {\n  if (findByEmail(email)) throw new Error(\"User already exists\");\n  const hash = await bcrypt.hash(password, 10);\n  const user: User = {\n    id: String(Date.now()),\n    email,\n    name,\n    passwordHash: hash,\n    role: users.length === 0 ? \"admin\" : \"analyst\",\n    createdAt: new Date().toISOString(),\n  };\n  users.push(user);\n  return user;\n}\n\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(plain, hash);\n}\n\n// â”€â”€â”€ JWT â”€â”€â”€\nexport function signToken(userId: string, email: string): string {\n  return jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: \"7d\" });\n}\n\nexport function verifyToken(token: string): { userId: string; email: string } | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as { userId: string; email: string };\n    return decoded;\n  } catch {\n    return null;\n  }\n}\n\n// â”€â”€â”€ Cookie helpers â”€â”€â”€\nexport function setAuthCookie<T>(res: NextResponse<T>, token: string): NextResponse<T> {\n  res.cookies.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n  });\n  return res;\n}\n\nexport function clearAuthCookie<T>(res: NextResponse<T>): NextResponse<T> {\n  res.cookies.set(COOKIE_NAME, \"\", { maxAge: 0, path: \"/\" });\n  return res;\n}\n\nexport function getTokenFromRequest(req: NextRequest): string | null {\n  const cookieHeader = req.headers.get(\"cookie\");\n  if (!cookieHeader) return null;\n  const cookies = parse(cookieHeader);\n  return cookies[COOKIE_NAME] || null;\n}\n\n// â”€â”€â”€ Auth middleware helper â”€â”€â”€\nexport function authenticateRequest(req: NextRequest): { user: User } | { error: string } {\n  const token = getTokenFromRequest(req);\n  if (!token) return { error: \"No token\" };\n  const payload = verifyToken(token);\n  if (!payload) return { error: \"Invalid token\" };\n  const user = users.find((u) => u.id === payload.userId);\n  if (!user) return { error: \"User not found\" };\n  return { user };\n}\n\nexport function sanitizeUser(user: User) {\n  const { passwordHash, ...safe } = user;\n  return safe;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,cAAc;AAYpB,MAAM,QAAgB,EAAE;AAExB,qBAAqB;AACrB,CAAC;IACC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,YAAY;IAC3C,MAAM,IAAI,CAAC;QACT,IAAI;QACJ,OAAO;QACP,MAAM;QACN,cAAc;QACd,MAAM;QACN,WAAW,IAAI,OAAO,WAAW;IACnC;AACF,CAAC;AAGM,SAAS,YAAY,KAAa;IACvC,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,CAAC,WAAW,OAAO,MAAM,WAAW;AACtE;AAEO,eAAe,WAAW,KAAa,EAAE,IAAY,EAAE,QAAgB;IAC5E,IAAI,YAAY,QAAQ,MAAM,IAAI,MAAM;IACxC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;IACzC,MAAM,OAAa;QACjB,IAAI,OAAO,KAAK,GAAG;QACnB;QACA;QACA,cAAc;QACd,MAAM,MAAM,MAAM,KAAK,IAAI,UAAU;QACrC,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,MAAM,IAAI,CAAC;IACX,OAAO;AACT;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B;AAGO,SAAS,UAAU,MAAc,EAAE,KAAa;IACrD,OAAO,kJAAG,CAAC,IAAI,CAAC;QAAE;QAAQ;IAAM,GAAG,YAAY;QAAE,WAAW;IAAK;AACnE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,SAAS,cAAiB,GAAoB,EAAE,KAAa;IAClE,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,OAAO;AACT;AAEO,SAAS,gBAAmB,GAAoB;IACrD,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI;QAAE,QAAQ;QAAG,MAAM;IAAI;IACxD,OAAO;AACT;AAEO,SAAS,oBAAoB,GAAgB;IAClD,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC;IACrC,IAAI,CAAC,cAAc,OAAO;IAC1B,MAAM,UAAU,IAAA,kJAAK,EAAC;IACtB,OAAO,OAAO,CAAC,YAAY,IAAI;AACjC;AAGO,SAAS,oBAAoB,GAAgB;IAClD,MAAM,QAAQ,oBAAoB;IAClC,IAAI,CAAC,OAAO,OAAO;QAAE,OAAO;IAAW;IACvC,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS,OAAO;QAAE,OAAO;IAAgB;IAC9C,MAAM,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,MAAM;IACtD,IAAI,CAAC,MAAM,OAAO;QAAE,OAAO;IAAiB;IAC5C,OAAO;QAAE;IAAK;AAChB;AAEO,SAAS,aAAa,IAAU;IACrC,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,GAAG;IAClC,OAAO;AACT"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///D:/haseeb/Projects/dashboard/src/app/api/analytics/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { authenticateRequest } from \"@/lib/auth-server\";\n\nfunction seededRandom(seed: number): () => number {\n  let s = seed;\n  return () => {\n    s = (s * 1664525 + 1013904223) & 0x7fffffff;\n    return s / 0x7fffffff;\n  };\n}\n\nfunction generateAnalytics() {\n  const rand = seededRandom(97);\n\n  // â”€â”€â”€ 1. Conversion Funnel â”€â”€â”€\n  const funnel = [\n    { stage: \"Landed\", value: 24800 },\n    { stage: \"Signed Up\", value: 18400 },\n    { stage: \"Onboarded\", value: 11200 },\n    { stage: \"Activated\", value: 6800 },\n    { stage: \"Converted\", value: 3200 },\n  ];\n\n  // â”€â”€â”€ 2. Cohort Retention (%) â€” 6 cohorts Ã— 6 weeks â”€â”€â”€\n  const cohortLabels = [\"Jan '25\",\"Feb '25\",\"Mar '25\",\"Apr '25\",\"May '25\",\"Jun '25\"];\n  const cohortRetention: number[][] = cohortLabels.map((_, ci) =>\n    Array.from({ length: 6 - ci }, (_, wi) => {\n      const base = wi === 0 ? 100 : 100 - wi * 16;\n      return Math.max(8, Math.round(base + (rand() - 0.5) * 12));\n    })\n  );\n\n  // â”€â”€â”€ 3. Geographic breakdown â”€â”€â”€\n  const geoData = [\n    { country: \"United States\", visitors: 38200, flag: \"ðŸ‡ºðŸ‡¸\", pct: 31.2 },\n    { country: \"United Kingdom\", visitors: 12800, flag: \"ðŸ‡¬ðŸ‡§\", pct: 10.5 },\n    { country: \"Germany\", visitors: 9400, flag: \"ðŸ‡©ðŸ‡ª\", pct: 7.7 },\n    { country: \"India\", visitors: 8900, flag: \"ðŸ‡®ðŸ‡³\", pct: 7.3 },\n    { country: \"Canada\", visitors: 7200, flag: \"ðŸ‡¨ðŸ‡¦\", pct: 5.9 },\n    { country: \"Australia\", visitors: 5800, flag: \"ðŸ‡¦ðŸ‡º\", pct: 4.7 },\n    { country: \"France\", visitors: 4600, flag: \"ðŸ‡«ðŸ‡·\", pct: 3.8 },\n    { country: \"Japan\", visitors: 3900, flag: \"ðŸ‡¯ðŸ‡µ\", pct: 3.2 },\n  ];\n\n  // â”€â”€â”€ 4. Device split â”€â”€â”€\n  const devices = [\n    { type: \"Desktop\", pct: 52, icon: \"ðŸ–¥ï¸\", color: \"#06b6d4\" },\n    { type: \"Mobile\", pct: 36, icon: \"ðŸ“±\", color: \"#8b5cf6\" },\n    { type: \"Tablet\", pct: 12, icon: \"ðŸ“²\", color: \"#10b981\" },\n  ];\n\n  // â”€â”€â”€ 5. Page performance table â”€â”€â”€\n  const pages = [\n    { path: \"/home\", views: 48200, avgTime: \"2m 34s\", bounce: 32.1, trend: 4.2 },\n    { path: \"/pricing\", views: 31600, avgTime: \"3m 12s\", bounce: 41.8, trend: -1.5 },\n    { path: \"/features\", views: 24800, avgTime: \"4m 08s\", bounce: 28.4, trend: 6.7 },\n    { path: \"/blog/getting-started\", views: 18900, avgTime: \"5m 45s\", bounce: 22.0, trend: 9.1 },\n    { path: \"/signup\", views: 14200, avgTime: \"1m 52s\", bounce: 55.3, trend: -3.8 },\n    { path: \"/dashboard\", views: 11800, avgTime: \"8m 20s\", bounce: 12.6, trend: 2.3 },\n    { path: \"/docs/api\", views: 9400, avgTime: \"6m 15s\", bounce: 18.9, trend: 5.0 },\n  ];\n\n  // â”€â”€â”€ 6. Sessions over time (daily last 30 days) â”€â”€â”€\n  const sessionData = Array.from({ length: 30 }, (_, i) => {\n    const base = 1800 + Math.sin(i * 0.4) * 400;\n    const weekend = (i % 7 >= 5) ? 0.6 : 1;\n    return {\n      day: i + 1,\n      sessions: Math.round((base + (rand() - 0.45) * 500) * weekend),\n      pageViews: Math.round((base * 3.2 + (rand() - 0.4) * 800) * weekend),\n    };\n  });\n\n  // â”€â”€â”€ 7. Top referrers â”€â”€â”€\n  const referrers = [\n    { source: \"google.com\", visits: 18400, newUsers: 12200 },\n    { source: \"twitter.com\", visits: 7800, newUsers: 5100 },\n    { source: \"github.com\", visits: 5600, newUsers: 4200 },\n    { source: \"producthunt.com\", visits: 4100, newUsers: 3600 },\n    { source: \"hackernews.com\", visits: 3200, newUsers: 2800 },\n  ];\n\n  return { funnel, cohortLabels, cohortRetention, geoData, devices, pages, sessionData, referrers };\n}\n\nexport async function GET(req: NextRequest) {\n  const result = authenticateRequest(req);\n  if (\"error\" in result) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  return NextResponse.json(generateAnalytics());\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,SAAS,aAAa,IAAY;IAChC,IAAI,IAAI;IACR,OAAO;QACL,IAAI,AAAC,IAAI,UAAU,aAAc;QACjC,OAAO,IAAI;IACb;AACF;AAEA,SAAS;IACP,MAAM,OAAO,aAAa;IAE1B,+BAA+B;IAC/B,MAAM,SAAS;QACb;YAAE,OAAO;YAAU,OAAO;QAAM;QAChC;YAAE,OAAO;YAAa,OAAO;QAAM;QACnC;YAAE,OAAO;YAAa,OAAO;QAAM;QACnC;YAAE,OAAO;YAAa,OAAO;QAAK;QAClC;YAAE,OAAO;YAAa,OAAO;QAAK;KACnC;IAED,wDAAwD;IACxD,MAAM,eAAe;QAAC;QAAU;QAAU;QAAU;QAAU;QAAU;KAAU;IAClF,MAAM,kBAA8B,aAAa,GAAG,CAAC,CAAC,GAAG,KACvD,MAAM,IAAI,CAAC;YAAE,QAAQ,IAAI;QAAG,GAAG,CAAC,GAAG;YACjC,MAAM,OAAO,OAAO,IAAI,MAAM,MAAM,KAAK;YACzC,OAAO,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,OAAO,CAAC,SAAS,GAAG,IAAI;QACxD;IAGF,kCAAkC;IAClC,MAAM,UAAU;QACd;YAAE,SAAS;YAAiB,UAAU;YAAO,MAAM;YAAQ,KAAK;QAAK;QACrE;YAAE,SAAS;YAAkB,UAAU;YAAO,MAAM;YAAQ,KAAK;QAAK;QACtE;YAAE,SAAS;YAAW,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;QAC7D;YAAE,SAAS;YAAS,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;QAC3D;YAAE,SAAS;YAAU,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;QAC5D;YAAE,SAAS;YAAa,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;QAC/D;YAAE,SAAS;YAAU,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;QAC5D;YAAE,SAAS;YAAS,UAAU;YAAM,MAAM;YAAQ,KAAK;QAAI;KAC5D;IAED,0BAA0B;IAC1B,MAAM,UAAU;QACd;YAAE,MAAM;YAAW,KAAK;YAAI,MAAM;YAAO,OAAO;QAAU;QAC1D;YAAE,MAAM;YAAU,KAAK;YAAI,MAAM;YAAM,OAAO;QAAU;QACxD;YAAE,MAAM;YAAU,KAAK;YAAI,MAAM;YAAM,OAAO;QAAU;KACzD;IAED,oCAAoC;IACpC,MAAM,QAAQ;QACZ;YAAE,MAAM;YAAS,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO;QAAI;QAC3E;YAAE,MAAM;YAAY,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO,CAAC;QAAI;QAC/E;YAAE,MAAM;YAAa,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO;QAAI;QAC/E;YAAE,MAAM;YAAyB,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO;QAAI;QAC3F;YAAE,MAAM;YAAW,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO,CAAC;QAAI;QAC9E;YAAE,MAAM;YAAc,OAAO;YAAO,SAAS;YAAU,QAAQ;YAAM,OAAO;QAAI;QAChF;YAAE,MAAM;YAAa,OAAO;YAAM,SAAS;YAAU,QAAQ;YAAM,OAAO;QAAI;KAC/E;IAED,qDAAqD;IACrD,MAAM,cAAc,MAAM,IAAI,CAAC;QAAE,QAAQ;IAAG,GAAG,CAAC,GAAG;QACjD,MAAM,OAAO,OAAO,KAAK,GAAG,CAAC,IAAI,OAAO;QACxC,MAAM,UAAU,AAAC,IAAI,KAAK,IAAK,MAAM;QACrC,OAAO;YACL,KAAK,IAAI;YACT,UAAU,KAAK,KAAK,CAAC,CAAC,OAAO,CAAC,SAAS,IAAI,IAAI,GAAG,IAAI;YACtD,WAAW,KAAK,KAAK,CAAC,CAAC,OAAO,MAAM,CAAC,SAAS,GAAG,IAAI,GAAG,IAAI;QAC9D;IACF;IAEA,2BAA2B;IAC3B,MAAM,YAAY;QAChB;YAAE,QAAQ;YAAc,QAAQ;YAAO,UAAU;QAAM;QACvD;YAAE,QAAQ;YAAe,QAAQ;YAAM,UAAU;QAAK;QACtD;YAAE,QAAQ;YAAc,QAAQ;YAAM,UAAU;QAAK;QACrD;YAAE,QAAQ;YAAmB,QAAQ;YAAM,UAAU;QAAK;QAC1D;YAAE,QAAQ;YAAkB,QAAQ;YAAM,UAAU;QAAK;KAC1D;IAED,OAAO;QAAE;QAAQ;QAAc;QAAiB;QAAS;QAAS;QAAO;QAAa;IAAU;AAClG;AAEO,eAAe,IAAI,GAAgB;IACxC,MAAM,SAAS,IAAA,qJAAmB,EAAC;IACnC,IAAI,WAAW,QAAQ,OAAO,gJAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAe,GAAG;QAAE,QAAQ;IAAI;IACzF,OAAO,gJAAY,CAAC,IAAI,CAAC;AAC3B"}}]
}