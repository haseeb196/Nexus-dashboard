{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///D:/haseeb/Projects/dashboard/src/lib/auth-server.ts"],"sourcesContent":["import bcrypt from \"bcryptjs\";\nimport jwt from \"jsonwebtoken\";\nimport { parse, serialize } from \"cookie\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nconst JWT_SECRET = process.env.JWT_SECRET || \"nexus-dashboard-secret-key-change-in-prod\";\nconst COOKIE_NAME = \"nexus_token\";\n\n// ─── In-memory user store (replace with DB in production) ───\nexport interface User {\n  id: string;\n  email: string;\n  name: string;\n  passwordHash: string;\n  role: \"admin\" | \"analyst\" | \"viewer\";\n  createdAt: string;\n}\n\nconst users: User[] = [];\n\n// Seed default admin\n(async () => {\n  const hash = await bcrypt.hash(\"admin123\", 10);\n  users.push({\n    id: \"1\",\n    email: \"admin@nexus.io\",\n    name: \"Alex Morgan\",\n    passwordHash: hash,\n    role: \"admin\",\n    createdAt: new Date().toISOString(),\n  });\n})();\n\n// ─── User CRUD ───\nexport function findByEmail(email: string): User | undefined {\n  return users.find((u) => u.email.toLowerCase() === email.toLowerCase());\n}\n\nexport async function createUser(email: string, name: string, password: string): Promise<User> {\n  if (findByEmail(email)) throw new Error(\"User already exists\");\n  const hash = await bcrypt.hash(password, 10);\n  const user: User = {\n    id: String(Date.now()),\n    email,\n    name,\n    passwordHash: hash,\n    role: users.length === 0 ? \"admin\" : \"analyst\",\n    createdAt: new Date().toISOString(),\n  };\n  users.push(user);\n  return user;\n}\n\nexport async function verifyPassword(plain: string, hash: string): Promise<boolean> {\n  return bcrypt.compare(plain, hash);\n}\n\n// ─── JWT ───\nexport function signToken(userId: string, email: string): string {\n  return jwt.sign({ userId, email }, JWT_SECRET, { expiresIn: \"7d\" });\n}\n\nexport function verifyToken(token: string): { userId: string; email: string } | null {\n  try {\n    const decoded = jwt.verify(token, JWT_SECRET) as { userId: string; email: string };\n    return decoded;\n  } catch {\n    return null;\n  }\n}\n\n// ─── Cookie helpers ───\nexport function setAuthCookie<T>(res: NextResponse<T>, token: string): NextResponse<T> {\n  res.cookies.set(COOKIE_NAME, token, {\n    httpOnly: true,\n    secure: process.env.NODE_ENV === \"production\",\n    sameSite: \"lax\",\n    path: \"/\",\n    maxAge: 60 * 60 * 24 * 7, // 7 days\n  });\n  return res;\n}\n\nexport function clearAuthCookie<T>(res: NextResponse<T>): NextResponse<T> {\n  res.cookies.set(COOKIE_NAME, \"\", { maxAge: 0, path: \"/\" });\n  return res;\n}\n\nexport function getTokenFromRequest(req: NextRequest): string | null {\n  const cookieHeader = req.headers.get(\"cookie\");\n  if (!cookieHeader) return null;\n  const cookies = parse(cookieHeader);\n  return cookies[COOKIE_NAME] || null;\n}\n\n// ─── Auth middleware helper ───\nexport function authenticateRequest(req: NextRequest): { user: User } | { error: string } {\n  const token = getTokenFromRequest(req);\n  if (!token) return { error: \"No token\" };\n  const payload = verifyToken(token);\n  if (!payload) return { error: \"Invalid token\" };\n  const user = users.find((u) => u.id === payload.userId);\n  if (!user) return { error: \"User not found\" };\n  return { user };\n}\n\nexport function sanitizeUser(user: User) {\n  const { passwordHash, ...safe } = user;\n  return safe;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;;;;AAGA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAC7C,MAAM,cAAc;AAYpB,MAAM,QAAgB,EAAE;AAExB,qBAAqB;AACrB,CAAC;IACC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,YAAY;IAC3C,MAAM,IAAI,CAAC;QACT,IAAI;QACJ,OAAO;QACP,MAAM;QACN,cAAc;QACd,MAAM;QACN,WAAW,IAAI,OAAO,WAAW;IACnC;AACF,CAAC;AAGM,SAAS,YAAY,KAAa;IACvC,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,KAAK,CAAC,WAAW,OAAO,MAAM,WAAW;AACtE;AAEO,eAAe,WAAW,KAAa,EAAE,IAAY,EAAE,QAAgB;IAC5E,IAAI,YAAY,QAAQ,MAAM,IAAI,MAAM;IACxC,MAAM,OAAO,MAAM,8IAAM,CAAC,IAAI,CAAC,UAAU;IACzC,MAAM,OAAa;QACjB,IAAI,OAAO,KAAK,GAAG;QACnB;QACA;QACA,cAAc;QACd,MAAM,MAAM,MAAM,KAAK,IAAI,UAAU;QACrC,WAAW,IAAI,OAAO,WAAW;IACnC;IACA,MAAM,IAAI,CAAC;IACX,OAAO;AACT;AAEO,eAAe,eAAe,KAAa,EAAE,IAAY;IAC9D,OAAO,8IAAM,CAAC,OAAO,CAAC,OAAO;AAC/B;AAGO,SAAS,UAAU,MAAc,EAAE,KAAa;IACrD,OAAO,kJAAG,CAAC,IAAI,CAAC;QAAE;QAAQ;IAAM,GAAG,YAAY;QAAE,WAAW;IAAK;AACnE;AAEO,SAAS,YAAY,KAAa;IACvC,IAAI;QACF,MAAM,UAAU,kJAAG,CAAC,MAAM,CAAC,OAAO;QAClC,OAAO;IACT,EAAE,OAAM;QACN,OAAO;IACT;AACF;AAGO,SAAS,cAAiB,GAAoB,EAAE,KAAa;IAClE,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,OAAO;QAClC,UAAU;QACV,QAAQ,oDAAyB;QACjC,UAAU;QACV,MAAM;QACN,QAAQ,KAAK,KAAK,KAAK;IACzB;IACA,OAAO;AACT;AAEO,SAAS,gBAAmB,GAAoB;IACrD,IAAI,OAAO,CAAC,GAAG,CAAC,aAAa,IAAI;QAAE,QAAQ;QAAG,MAAM;IAAI;IACxD,OAAO;AACT;AAEO,SAAS,oBAAoB,GAAgB;IAClD,MAAM,eAAe,IAAI,OAAO,CAAC,GAAG,CAAC;IACrC,IAAI,CAAC,cAAc,OAAO;IAC1B,MAAM,UAAU,IAAA,kJAAK,EAAC;IACtB,OAAO,OAAO,CAAC,YAAY,IAAI;AACjC;AAGO,SAAS,oBAAoB,GAAgB;IAClD,MAAM,QAAQ,oBAAoB;IAClC,IAAI,CAAC,OAAO,OAAO;QAAE,OAAO;IAAW;IACvC,MAAM,UAAU,YAAY;IAC5B,IAAI,CAAC,SAAS,OAAO;QAAE,OAAO;IAAgB;IAC9C,MAAM,OAAO,MAAM,IAAI,CAAC,CAAC,IAAM,EAAE,EAAE,KAAK,QAAQ,MAAM;IACtD,IAAI,CAAC,MAAM,OAAO;QAAE,OAAO;IAAiB;IAC5C,OAAO;QAAE;IAAK;AAChB;AAEO,SAAS,aAAa,IAAU;IACrC,MAAM,EAAE,YAAY,EAAE,GAAG,MAAM,GAAG;IAClC,OAAO;AACT"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file:///D:/haseeb/Projects/dashboard/src/app/api/messages/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { authenticateRequest } from \"@/lib/auth-server\";\n\nconst conversations = [\n  {\n    id: 1, contact: \"Sofia Chen\", avatar: \"SC\", unread: 2, lastTime: \"2 min ago\", pinned: true,\n    lastMessage: \"Can you share the Q4 analytics report draft?\",\n    messages: [\n      { from: \"Sofia Chen\", text: \"Hey, do you have the latest analytics?\", time: \"10:24 AM\", mine: false },\n      { from: \"You\", text: \"Sure, let me pull it up now.\", time: \"10:25 AM\", mine: true },\n      { from: \"Sofia Chen\", text: \"Great, also need the cohort retention numbers.\", time: \"10:28 AM\", mine: false },\n      { from: \"You\", text: \"On it. I'll send both in one doc.\", time: \"10:29 AM\", mine: true },\n      { from: \"Sofia Chen\", text: \"Can you share the Q4 analytics report draft?\", time: \"10:34 AM\", mine: false },\n    ],\n  },\n  {\n    id: 2, contact: \"Raj Patel\", avatar: \"RP\", unread: 1, lastTime: \"18 min ago\", pinned: true,\n    lastMessage: \"The model accuracy is at 91.4% now.\",\n    messages: [\n      { from: \"Raj Patel\", text: \"Running the new model training now.\", time: \"9:50 AM\", mine: false },\n      { from: \"You\", text: \"What dataset are you using?\", time: \"9:52 AM\", mine: true },\n      { from: \"Raj Patel\", text: \"The expanded Jan-Dec dataset.\", time: \"9:55 AM\", mine: false },\n      { from: \"Raj Patel\", text: \"The model accuracy is at 91.4% now.\", time: \"10:15 AM\", mine: false },\n    ],\n  },\n  {\n    id: 3, contact: \"Emma Wilson\", avatar: \"EW\", unread: 0, lastTime: \"1 hr ago\", pinned: false,\n    lastMessage: \"The campaign goes live tomorrow at 9 AM.\",\n    messages: [\n      { from: \"You\", text: \"What's the status on the email campaign?\", time: \"8:40 AM\", mine: true },\n      { from: \"Emma Wilson\", text: \"Designs are approved. Copy is finalized.\", time: \"8:45 AM\", mine: false },\n      { from: \"Emma Wilson\", text: \"The campaign goes live tomorrow at 9 AM.\", time: \"8:48 AM\", mine: false },\n    ],\n  },\n  {\n    id: 4, contact: \"Lucas Martin\", avatar: \"LM\", unread: 0, lastTime: \"2 hrs ago\", pinned: false,\n    lastMessage: \"I'll have the PR up by end of day.\",\n    messages: [\n      { from: \"You\", text: \"How's the auth refactor coming along?\", time: \"7:10 AM\", mine: true },\n      { from: \"Lucas Martin\", text: \"Almost done. Found a couple edge cases.\", time: \"7:30 AM\", mine: false },\n      { from: \"You\", text: \"Make sure to add unit tests for those.\", time: \"7:32 AM\", mine: true },\n      { from: \"Lucas Martin\", text: \"I'll have the PR up by end of day.\", time: \"7:45 AM\", mine: false },\n    ],\n  },\n  {\n    id: 5, contact: \"Aisha Khan\", avatar: \"AK\", unread: 0, lastTime: \"3 hrs ago\", pinned: false,\n    lastMessage: \"Let's schedule a sync for Friday at 2pm.\",\n    messages: [\n      { from: \"Aisha Khan\", text: \"Product roadmap review is this week.\", time: \"6:20 AM\", mine: false },\n      { from: \"You\", text: \"I'll prep the metrics deck.\", time: \"6:25 AM\", mine: true },\n      { from: \"Aisha Khan\", text: \"Let's schedule a sync for Friday at 2pm.\", time: \"6:30 AM\", mine: false },\n    ],\n  },\n  {\n    id: 6, contact: \"Mia Thompson\", avatar: \"MT\", unread: 0, lastTime: \"Yesterday\", pinned: false,\n    lastMessage: \"Correlation looks strong. Publishing the findings.\",\n    messages: [\n      { from: \"You\", text: \"Any luck with the A/B test analysis?\", time: \"4:15 PM\", mine: true },\n      { from: \"Mia Thompson\", text: \"Yes! Variant B is 14% better.\", time: \"4:40 PM\", mine: false },\n      { from: \"Mia Thompson\", text: \"Correlation looks strong. Publishing the findings.\", time: \"4:42 PM\", mine: false },\n    ],\n  },\n  {\n    id: 7, contact: \"Oliver Wright\", avatar: \"OW\", unread: 0, lastTime: \"Yesterday\", pinned: false,\n    lastMessage: \"Blog post is scheduled for Monday.\",\n    messages: [\n      { from: \"Oliver Wright\", text: \"Finished the case study draft.\", time: \"2:00 PM\", mine: false },\n      { from: \"You\", text: \"Looks great. Minor edits on page 3.\", time: \"2:20 PM\", mine: true },\n      { from: \"Oliver Wright\", text: \"Blog post is scheduled for Monday.\", time: \"2:35 PM\", mine: false },\n    ],\n  },\n];\n\nexport async function GET(req: NextRequest) {\n  const result = authenticateRequest(req);\n  if (\"error\" in result) return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 });\n  const unreadCount = conversations.reduce((s, c) => s + c.unread, 0);\n  return NextResponse.json({ conversations, unreadCount });\n}\n"],"names":[],"mappings":"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"}}]
}